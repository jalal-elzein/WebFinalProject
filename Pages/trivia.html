<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Trivia</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
        <link rel="stylesheet" href="../Styles/style.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    </head>

    <body>
        <div class="container text-center">
            <div class="row">
                <h1>Trivia Game</h1>
            </div>

            <a href="../Game/index.html">Platformer Game!</a>

            <br>
            <br>

            <div class="d-flex justify-content-center">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Score</h5>
                        <p class="card-text">
                            <span id="score">0</span>
                            <span>/10</span>
                        </p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Question</h5>
                        <p class="card-text">
                            <span id="qnum">0</span>
                            <span>/10</span>
                        </p>
                    </div>
                </div>
            </div>

            <br>

            <div class="card" style="padding: 10px 20px;" id="gamecard">
                <div class="row">
                    <h2 id="question"></h2>
                </div>

                <br>
                <br>

                <div class="row margin-tb-10">
                    <div class="col">
                        <button class="btn btn-outline-dark w-100 answer-btn" value="1" id="btn1"></button>
                    </div>

                    <div class="col">
                        <button class="btn btn-outline-dark w-100 answer-btn" value="2" id="btn2"></button>
                    </div>
                </div>

                <div class="row margin-tb-10">
                    <div class="col">
                        <button class="btn btn-outline-dark w-100 answer-btn" value="3" id="btn3"></button>
                    </div>

                    <div class="col">
                        <button class="btn btn-outline-dark w-100 answer-btn" value="4" id="btn4"></button>
                    </div>
                </div>

                <div class="text-center">
                    <button class="btn btn-outline-dark w-50 hidden" id="next">Next</button>
                    
                    <button class="btn btn-outline-dark w-50 hidden" id="lb"
                    onclick="window.location.href = 'leaderboards/trivia.php';">Leaderboard</button>
                    
                    <button class="btn btn-outline-dark w-50 hidden" id="home"
                    onclick="window.location.href = 'index.html';">Home</button>
                    
                    <button class="btn btn-outline-dark w-50 hidden" id="restart">Restart</button>
                </div>
            </div>

            <button class="btn btn-outline-dark w-100" id="start">Start</button>
        </div>

        <form>
            <input type="hidden" name="score2send" id="score2send">
        </form>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
            </script>
    </body>

    <script>
        $(document).ready(function () {
            $("#gamecard").addClass("hidden");
            $.ajax({
                url: '../Backend/trivia/reset_questions.php',
                type: 'POST',
                error: function (xhr, status, error) {
                    console.log(error);
                },
                success: function (response) {
                    console.log("reset response: " + response);
                }
            })
        })

        $('.answer-btn').click(function () {
            if ($(this).val() == 1) {
                $(this).addClass("correct");
                $("#score").html(parseInt($("#score").html()) + 1);
            } else {
                $(this).addClass("wrong");
            }

            $('.answer-btn').each(function () {
                if ($(this).val() == 1) {
                    console.log($(this).html());
                    $(this).addClass("correct");
                }
            });

            $(".answer-btn").not(this).prop("disabled", true);

            if ($("#qnum").html() != "10") {
                $("#next").removeClass("hidden");
            }

            else {
                $("#home").removeClass("hidden");
                $("#lb").removeClass("hidden");
                $("#restart").removeClass("hidden");
                $("#score2send").val($("#score").html());
                $("form").submit();
            }
        })

        // TODO: make sure not to duplicate questions
        function getNextQuestion() {
            $(this).addClass("hidden");
            $("#gamecard").removeClass("hidden");

            $.ajax({
                url: '../Backend/trivia/trivia_back.php',
                dataType: 'json',
                success: function (data) {
                    // process data
                    var q = data.q;
                    var a = data.a;

                    console.log(q);
                    console.log(a);

                    $("#question").html(q["number"] + ". " + q["text"]);

                    // TODO: loop this?
                    $("#btn1").html(a[0]["text"]);
                    $("#btn1").val(a[0]["correct"])
                    $("#btn2").html(a[1]["text"]);
                    $("#btn2").val(a[1]["correct"])
                    $("#btn3").html(a[2]["text"]);
                    $("#btn3").val(a[2]["correct"])
                    $("#btn4").html(a[3]["text"]);
                    $("#btn4").val(a[3]["correct"])
                },
                error: function (xhr, status, error) {
                    console.log('Error:', error);
                }
            });

            $(".answer-btn").prop("disabled", false);
            $(".answer-btn").removeClass("correct").removeClass("wrong");

            $("#qnum").html(parseInt($("#qnum").html()) + 1);
        }

        $("#start").click(getNextQuestion);

        $("#next").click(getNextQuestion);

        $('form').submit(function (event) {
            event.preventDefault();

            var data = $('#score2send').val();

            $.ajax({
                url: '../Backend/trivia/save_score.php',
                type: 'POST',
                data: { data: data },
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        });
        
        $("#restart").click(function () {
            $.ajax({
                url: '../Backend/trivia/reset_questions.php',
                type: 'POST',
                error: function (xhr, status, error) {
                    console.log(error);
                },
                success: function (response) {
                    console.log("reset response: " + response);
                }
            })
            $(".answer-btn").prop("disabled", false);
            $(".answer-btn").removeClass("correct").removeClass("wrong");
            $("#qnum").html("0");
            $("#score").html(parseInt("0"));
            $("#home").addClass("hidden");
            $("#lb").addClass("hidden");
            $("#restart").addClass("hidden");
            $("#score2send").val("0");
            getNextQuestion();
        })
    </script>

</html>